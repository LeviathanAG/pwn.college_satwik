from sage.all import randint, next_prime
from Crypto.Util.number import bytes_to_long

class RSA:
    def __init__(self, hb, lb) -> None:
        self.hb = hb
        self.lb = lb
        self.u1 = randint(0, 2**30)
        self.u2 = randint(0, 2**30)
        self.keygen()
    
    def keygen(self) -> None:
        self.base = randint(2**self.hb-1, 2**self.hb)
        self.e = 0x10001
        self.p = next_prime(self.u1*self.base + randint(2, 2**self.lb))
        self.q = next_prime(self.u2*self.base + randint(2, 2**self.lb))
        self.n = self.p * self.q

    def sum(self):
        return self.u1**2 + self.u2**2

    def encrypt(self, m: bytes) -> int:
        m_ = bytes_to_long(m)
        c = pow(m_, self.e, self.n)
        return c
    

rsa = RSA(
    hb=2048,
    lb=256
)
print(f"c0 = {rsa.sum()}")
print(f"c1 = {rsa.encrypt(b'REDACTED FLAG')}")
print(f"c2 = {rsa.encrypt(b'Lorem Ipsum is simply dummy text of')}")
print(f"c3 = {rsa.encrypt(b'the printing and typesetting industry')}")



# (615951939, 660144937)

# N = 389007094093500254659269222829300387668660508842596830283034437854937893235049227182800673983137449438686100431357337665683342739525263623592976332059392395264355698296935420024804741703608973190824917028700611656793563033953362739610335126391232258457097837434427619484534528039920830798211549635295178547023617400379055165909284909149495704721001995786010441636120118520833637102034834824318276159998436988458827216771341547723063116002296802980383058543399672672199299812493420476411710717355307773919162706183079395944012029903656708803248090318792228189733289364091794724586461446778415085835534447274059679497460815715111338701331142301424455494636080084200859380926481450668571474030244841321651468346520918746151217651066760145599691569837763734157601936442708850694948902162338810617437621276232570511323743061902828900722778980874258644691568558368246727586863719198403474239414064157294529929203124574829369966931627809307593655658002862921413850262644887434399341306324601519965584391277327657682339232296466760699235858204994705697120103836006265934580279994007554238442080989089861523384446940617433150587916974122607314408287293310331411631383254795350186812538871979413905851197122211878687803160562136852590752062852078911108328555229